<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voz a Texto</title>
    <style>
        #status {
            font-weight: bold;
            color: red;
        }
        .chat-container {
            width: 100%;
            max-width: 400px;
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: 10px;
            height: 300px;
            overflow-y: auto;
            display: flex;
            flex-direction: column-reverse;
        }
        .message {
            background: #dcf8c6;
            padding: 5px 10px;
            border-radius: 10px;
            margin: 5px 0;
            align-self: flex-start;
            display: flex;
            align-items: center;
            cursor: pointer;
            width: 100%;
        }
        .listening {
            color: green;
        }
    </style>
</head>
<body>
    <button id="toggleBtn">Activar Voz 1</button>
    <span id="status">Micrófono apagado</span>
    <div class="chat-container" id="chat"></div>

    <script>
        let recognition;
        let isListening = false;
        let chatContainer = document.getElementById('chat');
        let statusIndicator = document.getElementById('status');
        let messageId = parseInt(localStorage.getItem('messageId')) || 0;

        function addMessage(text, id) {
            let messageElement = document.createElement('div');
            messageElement.classList.add('message');
            messageElement.setAttribute('data-id', id);
            messageElement.innerText = text;
            chatContainer.prepend(messageElement);
        }

        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = false;
            recognition.lang = 'es-ES';

            recognition.onresult = function(event) {
                let finalTranscript = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    finalTranscript += event.results[i][0].transcript + ' ';
                }
                addMessage(finalTranscript.trim(), messageId++);
            };

            recognition.onend = function() {
                if (isListening) {
                    recognition.start(); // Reiniciar la escucha automáticamente
                }
            };
        } else {
            alert("Tu navegador no soporta el reconocimiento de voz.");
        }

        document.getElementById('toggleBtn').addEventListener('click', function() {
            if (!isListening) {
                recognition.start();
                this.innerText = 'Desactivar Voz';
                statusIndicator.innerText = 'Escuchando...';
                statusIndicator.classList.add('listening');
            } else {
                recognition.stop();
                this.innerText = 'Activar Voz';
                statusIndicator.innerText = 'Micrófono apagado';
                statusIndicator.classList.remove('listening');
            }
            isListening = !isListening;
        });
    </script>
</body>
</html>
